<!doctype html>
<meta charset="utf-8" />
<title>Yer browser seems a lil Rusty</title>
<link rel="stylesheet" href="" />
<body>
  <input id='reg' type = 'text' style='font-family: monospace'>
  <input id='target' type = 'text' style='font-family: monospace'>
  <div id='result' />
  <script type='module'>
    import { instantiate } from "./site.js"

    fetch("site.wasm")
      .then(resp => resp.arrayBuffer())

      .then(wasm => instantiate(wasm))

      .then(mod => {
        const updateResult = function() {
          const reg = document.getElementById('reg').value || ''
          const target = document.getElementById('target').value || ''
          var result = document.getElementById('result')
          const regex_err = mod.validate_regex(reg)
          result.innerHTML = regex_err === "" ? `
            <span style='font-family: monospace'>/${reg}/</span> ${
              mod.regex_compare(reg, target) ? 'matches' : 'does not match'
            } <span style='font-family: monospace'>"${target}"</span>
          ` : `
            <span style='font-family: monospace; color: salmon'>${regex_err}</span>
          `
        }

        document.getElementById('reg').onkeyup = updateResult
        document.getElementById('target').onkeyup = updateResult
        updateResult()
      })
  </script>
</body>
